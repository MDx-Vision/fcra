Got it, thanks for the extra info.

At this point the backend looks fine. The issue is in the **JS on the litigation review page**:

* The buttons are either not wired correctly, or
* The click handler is using placeholder text instead of the real response (`[200 or 400 or 500]`, `{...}`).

Let’s fix that by replacing the `<script>` block in `templates/litigation_review.html` with one that:

* Enables the buttons once the page loads
* Wires the click handlers
* Logs the **real** status and JSON body from `/api/approve/<id>`
* Shows alerts based on success / failure

### 1. Replace the script block in `litigation_review.html`

Find the `<script>` tag at the bottom of `litigation_review.html` and replace **everything inside it** with this:

```html
<script>
  // Simple logger to the red box
  function appendLog(msg) {
    const log = document.getElementById('log');
    const now = new Date().toLocaleTimeString();
    log.textContent += `${now} > ${msg}\n`;
    log.scrollTop = log.scrollHeight;
  }

  function getAnalysisId() {
    // /analysis/1/review -> "1"
    const parts = window.location.pathname.split('/').filter(Boolean);
    const id = parts[1]; // ["analysis","1","review"]
    return id;
  }

  async function loadAnalysis() {
    const analysisId = getAnalysisId();
    appendLog(`Analysis ID: ${analysisId}`);
    appendLog('Buttons wired, initial load starting...');
    appendLog('Fetching analysis data...');

    const url = `/api/analysis/${analysisId}/data`;
    appendLog(`GET ${url}`);

    try {
      const res = await fetch(url);
      appendLog(`Response status: ${res.status}`);

      const data = await res.json();
      appendLog('Data loaded.');

      const pre = document.getElementById('analysisData');
      pre.textContent = JSON.stringify(data, null, 2);
    } catch (err) {
      appendLog(`Error loading analysis: ${err.message}`);
      alert('Error loading analysis data. Check console for details.');
    }
  }

  async function onAcceptClick() {
    const analysisId = getAnalysisId();
    const url = `/api/approve/${analysisId}`;

    appendLog('Accept Case button clicked.');
    appendLog(`POST ${url}`);

    try {
      const res = await fetch(url, { method: 'POST' });
      appendLog(`Response status: ${res.status}`);

      let bodyText = '';
      let bodyJson = null;

      try {
        bodyJson = await res.json();
        bodyText = JSON.stringify(bodyJson, null, 2);
      } catch (e) {
        bodyText = '(could not parse JSON body)';
      }

      appendLog('Response body: ' + bodyText);

      if (!res.ok || !bodyJson || bodyJson.success === false) {
        const errMsg = bodyJson && bodyJson.error
          ? bodyJson.error
          : 'Unknown error from server';
        alert('Error: ' + errMsg);
        return;
      }

      alert('Success: client documents generated.');
      // Refresh analysis data so stage and other fields update
      await loadAnalysis();

    } catch (err) {
      appendLog(`Network or JS error: ${err.message}`);
      alert('Request failed: ' + err.message);
    }
  }

  async function onDownloadReportClick() {
    const analysisId = getAnalysisId();
    const url = `/api/download/analysis/${analysisId}/full_report`;
    appendLog(`Download Report clicked. Opening ${url}`);
    window.open(url, '_blank');
  }

  function wireButtons() {
    const refreshBtn = document.getElementById('refreshBtn');
    const acceptBtn = document.getElementById('acceptBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    if (!refreshBtn || !acceptBtn || !downloadBtn) {
      appendLog('Error: one or more buttons not found in DOM.');
      return;
    }

    refreshBtn.disabled = false;
    acceptBtn.disabled = false;
    downloadBtn.disabled = false;

    refreshBtn.addEventListener('click', loadAnalysis);
    acceptBtn.addEventListener('click', onAcceptClick);
    downloadBtn.addEventListener('click', onDownloadReportClick);

    appendLog('Buttons are wired and enabled.');
  }

  window.addEventListener('load', () => {
    appendLog('PAGE LOADED');
    wireButtons();
    loadAnalysis();
  });
</script>
```

### 2. Hard-refresh the page

After you save the template:

1. Stop and restart the Flask app if needed.
2. In the browser, do a **hard refresh** on `/analysis/1/review`

   * On Mac: `Cmd+Shift+R`
   * On Windows: `Ctrl+Shift+R`

### 3. Try again and read the log box

Now when you click **“Accept Case & Generate Letters”** you should see something like:

```
12:10:23 AM > Accept Case button clicked.
12:10:23 AM > POST /api/approve/1
12:10:25 AM > Response status: 200
12:10:25 AM > Response body: { "success": true, ... }
```

or, if there is a backend issue:

```
Response status: 400
Response body: { "success": false, "error": "Analysis is not in Stage 1" }
```

If you still get a 400/500 after this patch, send me the **exact** status code and the JSON in `Response body:` and we’ll fix the backend next.
