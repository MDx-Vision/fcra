name: PR Check

on:
  push:
    branches: [main]

permissions:
  contents: read
  pull-requests: read

jobs:
  check-pr:
    name: Check for PR
    runs-on: ubuntu-latest
    steps:
      - name: Check if push came from PR
        uses: actions/github-script@v7
        with:
          script: |
            const sha = context.sha;

            // Check if this commit is associated with a PR
            const { data: prs } = await github.rest.repos.listPullRequestsAssociatedWithCommit({
              owner: context.repo.owner,
              repo: context.repo.repo,
              commit_sha: sha
            });

            if (prs.length === 0) {
              console.log('');
              console.log('⚠️  ========================================');
              console.log('⚠️  DIRECT PUSH TO MAIN DETECTED');
              console.log('⚠️  ========================================');
              console.log('');
              console.log('This commit was pushed directly to main without a Pull Request.');
              console.log('');
              console.log('Best Practice: Please use Pull Requests for all changes to main so that:');
              console.log('  - CI checks run before merge');
              console.log('  - Changes can be reviewed');
              console.log('  - History is easier to track');
              console.log('');
              console.log('See CONTRIBUTING.md for guidelines.');
              console.log('');

              // Set output for potential use
              core.setOutput('direct_push', 'true');

              // This makes the check yellow/warning but doesn't fail
              core.warning('Direct push to main detected. Please use Pull Requests.');
            } else {
              console.log(`✅ Commit came from PR #${prs[0].number}: ${prs[0].title}`);
              core.setOutput('direct_push', 'false');
            }
