// Exhaustive test for /signup/welcome
describe('/signup/welcome Page Tests', () => {
  beforeEach(() => {
    // Public route - no auth required
    cy.visit('/signup/welcome');
  });

  describe('Page Load Tests', () => {
    it('should load without errors', () => {
      cy.url().should('include', '/signup/welcome');
      cy.get('body').should('be.visible');
    });

    it('should have correct page title', () => {
      cy.title().should('eq', 'Welcome - Brightpath Ascend Group');
    });

    it('should not have console errors', () => {
      cy.window().then((win) => {
        cy.stub(win.console, 'error').as('consoleError');
      });
      cy.reload();
      cy.get('@consoleError').should('not.have.been.called');
    });

    it('should return 200 status code', () => {
      cy.request('/signup/welcome').its('status').should('eq', 200);
    });
  });

  describe('Header/Navigation Tests', () => {
    it('should display header', () => {
      cy.get('header.header').should('be.visible');
    });

    it('should display logo image', () => {
      cy.get('.logo img').should('have.attr', 'src', '/static/images/logo.png');
      cy.get('.logo img').should('have.attr', 'alt', 'Logo');
    });

    it('should display logo text', () => {
      cy.get('.logo-text').should('be.visible');
      cy.get('.logo-text').should('contain.text', 'Brightpath');
      cy.get('.logo-text span').should('contain.text', 'Ascend');
      cy.get('.logo-text').should('contain.text', 'Group');
    });

    it('should have navigation links', () => {
      cy.get('nav.nav-links').should('be.visible');
      cy.get('nav.nav-links a').should('have.length', 3);
    });

    it('should have working Home link', () => {
      cy.get('nav.nav-links a[href="/"]').should('be.visible');
      cy.get('nav.nav-links a[href="/"]').should('contain.text', 'Home');
      cy.get('nav.nav-links a[href="/"]').click();
      cy.url().should('eq', Cypress.config().baseUrl + '/');
      cy.go('back');
    });

    it('should have working Client Login link', () => {
      cy.get('nav.nav-links a[href="/portal/login"]').should('be.visible');
      cy.get('nav.nav-links a[href="/portal/login"]').should('contain.text', 'Client Login');
    });

    it('should have working Call Us link', () => {
      cy.get('nav.nav-links a[href="/contact"]').should('be.visible');
      cy.get('nav.nav-links a[href="/contact"]').should('contain.text', 'Call Us');
    });
  });

  describe('Main Content Tests', () => {
    it('should display main content area', () => {
      cy.get('main.main-content').should('be.visible');
    });

    it('should display page title section', () => {
      cy.get('.page-title').should('be.visible');
    });

    it('should display H1 heading', () => {
      cy.get('h1').should('be.visible');
      cy.get('h1').should('contain.text', 'Start Your Credit Restoration Journey');
    });

    it('should display page subtitle', () => {
      cy.get('.page-subtitle').should('be.visible');
      cy.get('.page-subtitle').should('contain.text', 'Complete the form below to begin working with our team');
      cy.get('.page-subtitle').should('contain.text', 'We\'ll review your credit and create a personalized plan of action');
    });
  });

  describe('Progress Steps Tests', () => {
    it('should display progress steps container', () => {
      cy.get('.progress-steps').should('be.visible');
    });

    it('should have 4 progress steps', () => {
      cy.get('.progress-steps .step').should('have.length', 4);
    });

    it('should have all steps marked as completed', () => {
      cy.get('.progress-steps .step.completed').should('have.length', 4);
    });

    it('should display step 1 - Personal Info', () => {
      cy.get('.progress-steps .step').eq(0).within(() => {
        cy.get('.step-number').should('contain.text', '1');
        cy.get('span').should('contain.text', 'Personal Info');
      });
    });

    it('should display step 2 - Credit Access', () => {
      cy.get('.progress-steps .step').eq(1).within(() => {
        cy.get('.step-number').should('contain.text', '2');
        cy.get('span').should('contain.text', 'Credit Access');
      });
    });

    it('should display step 3 - Plan & Payment', () => {
      cy.get('.progress-steps .step').eq(2).within(() => {
        cy.get('.step-number').should('contain.text', '3');
        cy.get('span').should('contain.text', 'Plan & Payment');
      });
    });

    it('should display step 4 - Agreement', () => {
      cy.get('.progress-steps .step').eq(3).within(() => {
        cy.get('.step-number').should('contain.text', '4');
        cy.get('span').should('contain.text', 'Agreement');
      });
    });
  });

  describe('Content Grid Tests', () => {
    it('should display content grid', () => {
      cy.get('.content-grid').should('be.visible');
    });

    it('should have welcome card', () => {
      cy.get('.welcome-card').should('be.visible');
    });

    it('should have info panel', () => {
      cy.get('.info-panel').should('be.visible');
    });
  });

  describe('Welcome Card Tests', () => {
    it('should display success icon', () => {
      cy.get('.success-icon').should('be.visible');
      cy.get('.success-icon svg').should('be.visible');
      cy.get('.success-icon svg path').should('have.attr', 'd', 'M5 13l4 4L19 7');
    });

    it('should display H2 heading', () => {
      cy.get('.welcome-card h2').should('be.visible');
      cy.get('.welcome-card h2').should('contain.text', 'Welcome to Brightpath Ascend Group!');
    });

    it('should display welcome message', () => {
      cy.get('.welcome-card p').first().should('be.visible');
      cy.get('.welcome-card p').first().should('contain.text', 'Your registration is complete');
      cy.get('.welcome-card p').first().should('contain.text', 'We\'ll pull your credit report');
      cy.get('.welcome-card p').first().should('contain.text', '24-48 hours');
    });

    it('should display referral box', () => {
      cy.get('.referral-box').should('be.visible');
    });

    it('should display referral label', () => {
      cy.get('.referral-box label').should('be.visible');
      cy.get('.referral-box label').should('contain.text', 'Your Referral Code');
    });

    it('should display referral code', () => {
      cy.get('.referral-code').should('be.visible');
      cy.get('.referral-code').should('contain.text', 'REF-XXXXXXXX');
    });

    it('should display referral note', () => {
      cy.get('.referral-box .note').should('be.visible');
      cy.get('.referral-box .note').should('contain.text', 'Share this code with friends and family');
    });

    it('should display CTA button', () => {
      cy.get('.cta-button').should('be.visible');
      cy.get('.cta-button').should('contain.text', 'Go to Client Portal');
      cy.get('.cta-button').should('have.attr', 'href', '/portal/login');
    });

    it('should make CTA button clickable', () => {
      cy.get('.cta-button').should('not.be.disabled');
      cy.get('.cta-button').click();
      cy.url().should('include', '/portal/login');
      cy.go('back');
    });
  });

  describe('Info Panel Tests', () => {
    it('should display sample analysis card', () => {
      cy.get('.info-panel .info-card').first().should('be.visible');
    });

    it('should display sample analysis title', () => {
      cy.get('.info-card-title').first().should('be.visible');
      cy.get('.info-card-title').first().should('contain.text', 'SAMPLE ANALYSIS');
    });

    it('should display sample analysis description', () => {
      cy.get('.info-panel .info-card p').first().should('be.visible');
      cy.get('.info-panel .info-card p').first().should('contain.text', 'See what your credit analysis could reveal');
    });

    it('should display violations detected header', () => {
      cy.get('.info-panel').should('contain.text', 'VIOLATIONS DETECTED');
    });

    it('should display violation items', () => {
      cy.get('.violation-item').should('have.length', 3);
    });

    it('should display FCRA ยง 611 Dispute violation', () => {
      cy.get('.violation-item').eq(0).within(() => {
        cy.get('.violation-type').should('contain.text', 'FCRA ยง 611 Dispute');
        cy.get('.violation-desc').should('contain.text', 'Response period exceeded - Bureau failed to respond within 30 days');
      });
    });

    it('should display FCRA ยง 623 Furnisher violation', () => {
      cy.get('.violation-item').eq(1).within(() => {
        cy.get('.violation-type').should('contain.text', 'FCRA ยง 623 Furnisher');
        cy.get('.violation-desc').should('contain.text', 'Account marked late despite payment verification');
      });
    });

    it('should display FDCPA Collector violation', () => {
      cy.get('.violation-item').eq(2).within(() => {
        cy.get('.violation-type').should('contain.text', 'FDCPA Collector');
        cy.get('.violation-desc').should('contain.text', 'Collection account on credit report - potential statute of limitations');
      });
    });

    it('should display potential damages card', () => {
      cy.get('.info-card').eq(1).should('be.visible');
      cy.get('.info-card-title').eq(1).should('contain.text', 'POTENTIAL DAMAGES');
    });

    it('should display damages grid', () => {
      cy.get('.damages-grid').should('be.visible');
      cy.get('.damages-grid .damage-box').should('have.length', 2);
    });

    it('should display statutory damages', () => {
      cy.get('.damages-grid .damage-box').eq(0).within(() => {
        cy.get('.damage-label').should('contain.text', 'Statutory');
        cy.get('.damage-amount').should('contain.text', '$3,000');
      });
    });

    it('should display actual damages', () => {
      cy.get('.damages-grid .damage-box').eq(1).within(() => {
        cy.get('.damage-label').should('contain.text', 'Actual');
        cy.get('.damage-amount').should('contain.text', '$850');
      });
    });

    it('should display punitive damages', () => {
      cy.get('.info-card .damage-box').last().within(() => {
        cy.get('.damage-label').should('contain.text', 'Punitive (if willful)');
        cy.get('.damage-amount.orange').should('contain.text', '$2,500');
      });
    });

    it('should display estimated case value', () => {
      cy.get('.estimate-box').should('be.visible');
      cy.get('.estimate-label').should('contain.text', 'ESTIMATED CASE VALUE');
      cy.get('.estimate-amount').should('contain.text', '$6,350');
      cy.get('.estimate-note').should('contain.text', 'Based on 3+ violations with willful conduct');
    });

    it('should display summary card', () => {
      cy.get('.summary-card').should('be.visible');
      cy.get('.summary-item').should('have.length', 3);
    });

    it('should display disputed items summary', () => {
      cy.get('.summary-item').eq(0).should('contain.text', 'Disputed Items: 3');
    });

    it('should display reinsertion risk summary', () => {
      cy.get('.summary-item').eq(1).should('contain.text', 'Reinsertion Risk: High');
    });

    it('should display timeline summary', () => {
      cy.get('.summary-item').eq(2).should('contain.text', 'Timeline: 60-90 days');
    });
  });

  describe('Responsive Tests', () => {
    it('should display correctly on desktop (1280px)', () => {
      cy.viewport(1280, 720);
      cy.get('.content-grid').should('be.visible');
      cy.get('.welcome-card').should('be.visible');
      cy.get('.info-panel').should('be.visible');
    });

    it('should display correctly on tablet (768px)', () => {
      cy.viewport(768, 1024);
      cy.get('.content-grid').should('be.visible');
      cy.get('.welcome-card').should('be.visible');
      cy.get('.info-panel').should('be.visible');
    });

    it('should display correctly on mobile (375px)', () => {
      cy.viewport(375, 667);
      cy.get('.content-grid').should('be.visible');
      cy.get('.welcome-card').should('be.visible');
      cy.get('.info-panel').should('be.visible');
    });
  });

  describe('Error Handling Tests', () => {
    it('should handle missing logo image gracefully', () => {
      cy.get('.logo img').then(($img) => {
        $img[0].onerror();
        cy.get('.logo img').should('have.css', 'display', 'none');
      });
    });

    it('should handle network errors gracefully', () => {
      cy.intercept('GET', '/signup/welcome', { forceNetworkError: true }).as('networkError');
      cy.visit('/signup/welcome', { failOnStatusCode: false });
    });
  });

  describe('Accessibility Tests', () => {
    it('should have proper heading hierarchy', () => {
      cy.get('h1').should('have.length', 1);
      cy.get('h2').should('have.length', 1);
    });

    it('should have alt text for images', () => {
      cy.get('img').should('have.attr', 'alt');
    });

    it('should have proper link attributes', () => {
      cy.get('a[href]').each(($link) => {
        cy.wrap($link).should('have.attr', 'href');
      });
    });

    it('should have readable text contrast', () => {
      cy.get('body').should('have.css', 'color');
      cy.get('h1, h2, p').should('be.visible');
    });
  });

  describe('Performance Tests', () => {
    it('should load within reasonable time', () => {
      const start = Date.now();
      cy.visit('/signup/welcome').then(() => {
        const loadTime = Date.now() - start;
        expect(loadTime).to.be.lessThan(5000);
      });
    });

    it('should have all critical elements visible quickly', () => {
      cy.get('h1').should('be.visible');
      cy.get('.welcome-card').should('be.visible');
      cy.get('.cta-button').should('be.visible');
    });
  });
});
