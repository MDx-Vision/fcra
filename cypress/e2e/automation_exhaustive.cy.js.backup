// Exhaustive test for /dashboard/automation

describe('Staff Login Page - /dashboard/automation', () => {
  beforeEach(() => {
    cy.visit('/dashboard/automation');
  });

  describe('Page Load Tests', () => {
    it('should load the page without errors', () => {
      cy.url().should('include', '/dashboard/automation');
      cy.get('[data-testid="login-container"]').should('be.visible');
    });

    it('should have correct page title', () => {
      cy.title().should('contain', 'Staff Login - Brightpath Ascend FCRA Platform');
    });

    it('should not have console errors', () => {
      cy.window().then((win) => {
        cy.stub(win.console, 'error').as('consoleError');
      });
      cy.get('@consoleError').should('not.have.been.called');
    });

    it('should not return server errors', () => {
      cy.request('/dashboard/automation').then((response) => {
        expect(response.status).to.not.be.oneOf([404, 500, 502, 503]);
      });
    });
  });

  describe('UI Element Tests', () => {
    describe('Headings', () => {
      it('should display H1 heading with correct text', () => {
        cy.get('h1').should('be.visible').and('contain', 'Brightpath Ascend Group');
      });

      it('should display H2 heading with correct text', () => {
        cy.get('h2').should('be.visible').and('contain', 'Staff Login');
        cy.get('[data-testid="login-title"]').should('be.visible').and('contain', 'Staff Login');
      });
    });

    describe('Logo and Branding', () => {
      it('should display logo image', () => {
        cy.get('img[alt="Brightpath Ascend Group"]').should('be.visible').and('have.attr', 'src', '/static/images/logo.png');
      });

      it('should display platform subtitle', () => {
        cy.contains('FCRA Litigation Platform').should('be.visible');
      });

      it('should display staff badge with icon', () => {
        cy.get('.staff-badge').should('be.visible').and('contain', 'Staff Portal');
        cy.get('.staff-badge svg').should('exist');
      });
    });

    describe('Container Structure', () => {
      it('should display login container', () => {
        cy.get('[data-testid="login-container"]').should('be.visible');
      });

      it('should display login card', () => {
        cy.get('[data-testid="login-card"]').should('be.visible');
      });

      it('should display subtitle text', () => {
        cy.contains('Sign in to access the admin dashboard').should('be.visible');
      });
    });

    describe('Client Portal Link', () => {
      it('should display client portal link text', () => {
        cy.contains('Looking for client portal?').should('be.visible');
      });

      it('should have clickable client portal link', () => {
        cy.get('[data-testid="client-portal-link"]')
          .should('be.visible')
          .and('have.attr', 'href', '/portal/login')
          .and('contain', 'Client Login');
      });
    });
  });

  describe('Button Tests', () => {
    it('should display password toggle button', () => {
      cy.get('.toggle-btn').should('be.visible').and('contain', 'ðŸ‘');
    });

    it('should display sign in button', () => {
      cy.get('#loginBtn')
        .should('be.visible')
        .and('have.attr', 'type', 'submit')
        .and('contain', 'Sign In');
      cy.get('[data-testid="login-button"]').should('be.visible');
    });

    it('should have clickable buttons', () => {
      cy.get('.toggle-btn').should('not.be.disabled');
      cy.get('#loginBtn').should('not.be.disabled');
    });
  });

  describe('Form Tests', () => {
    describe('Form Structure', () => {
      it('should display login form with correct attributes', () => {
        cy.get('#loginForm')
          .should('be.visible')
          .and('have.attr', 'method', 'POST')
          .and('have.attr', 'action', '/staff/login');
        cy.get('[data-testid="login-form"]').should('be.visible');
      });

      it('should have proper form labels', () => {
        cy.get('label[for="email"]').should('be.visible').and('contain', 'Email Address');
        cy.get('label[for="password"]').should('be.visible').and('contain', 'Password');
      });
    });

    describe('Email Input Field', () => {
      it('should display email input with correct attributes', () => {
        cy.get('#email')
          .should('be.visible')
          .and('have.attr', 'type', 'email')
          .and('have.attr', 'name', 'email')
          .and('have.attr', 'required')
          .and('have.attr', 'placeholder', 'your@email.com')
          .and('have.attr', 'autocomplete', 'email');
        cy.get('[data-testid="email-input"]').should('be.visible');
      });

      it('should accept email input', () => {
        cy.get('#email').type('test@example.com').should('have.value', 'test@example.com');
      });

      it('should validate email format', () => {
        cy.get('#email').type('invalid-email');
        cy.get('#loginBtn').click();
        cy.get('#email:invalid').should('exist');
      });

      it('should show required field validation', () => {
        cy.get('#loginBtn').click();
        cy.get('#email:invalid').should('exist');
      });
    });

    describe('Password Input Field', () => {
      it('should display password input with correct attributes', () => {
        cy.get('#password')
          .should('be.visible')
          .and('have.attr', 'type', 'password')
          .and('have.attr', 'name', 'password')
          .and('have.attr', 'required')
          .and('have.attr', 'placeholder', 'Enter your password')
          .and('have.attr', 'autocomplete', 'current-password');
        cy.get('[data-testid="password-input"]').should('be.visible');
      });

      it('should accept password input', () => {
        cy.get('#password').type('password123').should('have.value', 'password123');
      });

      it('should show required field validation', () => {
        cy.get('#email').type('test@example.com');
        cy.get('#loginBtn').click();
        cy.get('#password:invalid').should('exist');
      });

      it('should have password toggle functionality', () => {
        cy.get('#password').type('testpassword');
        cy.get('#password').should('have.attr', 'type', 'password');
        cy.get('.toggle-btn').click();
        cy.get('#password').should('have.attr', 'type', 'text');
        cy.get('.toggle-btn').click();
        cy.get('#password').should('have.attr', 'type', 'password');
      });
    });

    describe('Form Submission', () => {
      it('should disable submit button and show loading state on form submission', () => {
        cy.get('#email').type('test@example.com');
        cy.get('#password').type('password123');
        cy.get('#loginBtn').click();
        cy.get('#loginBtn').should('be.disabled').and('contain', 'Signing in...');
      });

      it('should submit form with valid data', () => {
        cy.intercept('POST', '/staff/login', { statusCode: 200, body: { success: true } }).as('loginRequest');
        cy.get('#email').type('test@example.com');
        cy.get('#password').type('password123');
        cy.get('#loginBtn').click();
        cy.wait('@loginRequest').its('request.body').should('include', 'test@example.com');
      });

      it('should handle form validation errors', () => {
        cy.get('#email').type('invalid');
        cy.get('#password').type('short');
        cy.get('#loginBtn').click();
        cy.get('#email:invalid').should('exist');
      });
    });
  });

  describe('Interactive Element Tests', () => {
    it('should toggle password visibility when toggle button is clicked', () => {
      cy.get('#password').type('secretpassword');
      cy.get('#password').should('have.attr', 'type', 'password');
      cy.get('.toggle-btn').click();
      cy.get('#password').should('have.attr', 'type', 'text');
    });

    it('should navigate to client portal when link is clicked', () => {
      cy.get('[data-testid="client-portal-link"]').click();
      cy.url().should('include', '/portal/login');
    });

    it('should trigger form submission when submit button is clicked', () => {
      cy.get('#email').type('test@example.com');
      cy.get('#password').type('password123');
      cy.get('[data-testid="login-button"]').click();
      cy.get('#loginBtn').should('contain', 'Signing in...');
    });
  });

  describe('Responsive Tests', () => {
    const viewports = [
      { width: 1280, height: 720, name: 'Desktop' },
      { width: 768, height: 1024, name: 'Tablet' },
      { width: 375, height: 667, name: 'Mobile' }
    ];

    viewports.forEach(({ width, height, name }) => {
      it(`should display correctly on ${name} (${width}x${height})`, () => {
        cy.viewport(width, height);
        cy.get('[data-testid="login-container"]').should('be.visible');
        cy.get('[data-testid="login-card"]').should('be.visible');
        cy.get('#email').should('be.visible');
        cy.get('#password').should('be.visible');
        cy.get('#loginBtn').should('be.visible');
        cy.get('h1').should('be.visible');
        cy.get('h2').should('be.visible');
      });
    });
  });

  describe('Error Handling Tests', () => {
    it('should handle network errors gracefully', () => {
      cy.intercept('POST', '/staff/login', { forceNetworkError: true }).as('networkError');
      cy.get('#email').type('test@example.com');
      cy.get('#password').type('password123');
      cy.get('#loginBtn').click();
      cy.wait('@networkError');
    });

    it('should handle server errors', () => {
      cy.intercept('POST', '/staff/login', { statusCode: 500, body: { error: 'Server Error' } }).as('serverError');
      cy.get('#email').type('test@example.com');
      cy.get('#password').type('password123');
      cy.get('#loginBtn').click();
      cy.wait('@serverError');
    });

    it('should handle authentication errors', () => {
      cy.intercept('POST', '/staff/login', { statusCode: 401, body: { error: 'Invalid credentials' } }).as('authError');
      cy.get('#email').type('wrong@example.com');
      cy.get('#password').type('wrongpassword');
      cy.get('#loginBtn').click();
      cy.wait('@authError');
    });

    it('should validate empty form submission', () => {
      cy.get('#loginBtn').click();
      cy.get('#email:invalid').should('exist');
      cy.get('#password:invalid').should('exist');
    });

    it('should validate partial form submission', () => {
      cy.get('#email').type('test@example.com');
      cy.get('#loginBtn').click();
      cy.get('#password:invalid').should('exist');
    });
  });

  describe('Accessibility Tests', () => {
    it('should have proper form labels associated with inputs', () => {
      cy.get('label[for="email"]').should('exist');
      cy.get('label[for="password"]').should('exist');
      cy.get('#email').should('have.attr', 'id', 'email');
      cy.get('#password').should('have.attr', 'id', 'password');
    });

    it('should have proper autocomplete attributes', () => {
      cy.get('#email').should('have.attr', 'autocomplete', 'email');
      cy.get('#password').should('have.attr', 'autocomplete', 'current-password');
    });

    it('should have proper input types', () => {
      cy.get('#email').should('have.attr', 'type', 'email');
      cy.get('#password').should('have.attr', 'type', 'password');
    });
  });

  describe('Data Attribute Tests', () => {
    it('should have all required data-testid attributes', () => {
      cy.get('[data-testid="login-container"]').should('exist');
      cy.get('[data-testid="login-card"]').should('exist');
      cy.get('[data-testid="login-title"]').should('exist');
      cy.get('[data-testid="login-form"]').should('exist');
      cy.get('[data-testid="email-input"]').should('exist');
      cy.get('[data-testid="password-input"]').should('exist');
      cy.get('[data-testid="login-button"]').should('exist');
      cy.get('[data-testid="client-portal-link"]').should('exist');
    });
  });
});