{% extends 'partner_portal/base.html' %}
{% block title %}Clients{% endblock %}

{% block content %}
<div class="page-header">
    <div class="header-row">
        <div>
            <h1 class="page-title">Clients</h1>
            <p class="page-subtitle">Manage your organization's clients</p>
        </div>
        <a href="/partner/api/clients/export" class="btn btn-secondary">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                <polyline points="7 10 12 15 17 10"/>
                <line x1="12" y1="15" x2="12" y2="3"/>
            </svg>
            Export CSV
        </a>
    </div>
</div>

<!-- Stats -->
<div class="stats-grid mini">
    <div class="stat-card">
        <div class="stat-label">Total Clients</div>
        <div class="stat-value">{{ stats.total }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Active</div>
        <div class="stat-value">{{ stats.active }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Pending</div>
        <div class="stat-value">{{ stats.pending }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Completed</div>
        <div class="stat-value">{{ stats.completed }}</div>
    </div>
</div>

<!-- Filters -->
<div class="card">
    <div class="filters-bar">
        <div class="search-box">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
            </svg>
            <input type="text" placeholder="Search clients..." id="searchInput" class="form-input">
        </div>
        <select class="form-input" id="statusFilter" style="width: auto;">
            <option value="">All Status</option>
            <option value="active">Active</option>
            <option value="in_progress">In Progress</option>
            <option value="pending">Pending</option>
            <option value="complete">Complete</option>
            <option value="cancelled">Cancelled</option>
        </select>
    </div>
</div>

<!-- Clients Table -->
<div class="card">
    {% if clients %}
    <div class="table-container">
        <table id="clientsTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Status</th>
                    <th>Dispute Status</th>
                    <th>Round</th>
                    <th>Added</th>
                </tr>
            </thead>
            <tbody>
                {% for client in clients %}
                <tr data-status="{{ client.status }}">
                    <td><strong>{{ client.name }}</strong></td>
                    <td>{{ client.email or '-' }}</td>
                    <td>{{ client.phone or '-' }}</td>
                    <td>
                        <span class="badge {% if client.status in ['active', 'in_progress'] %}badge-success{% elif client.status == 'complete' %}badge-info{% elif client.status == 'cancelled' %}badge-error{% else %}badge-muted{% endif %}">
                            {{ client.status or 'Pending' }}
                        </span>
                    </td>
                    <td>{{ client.dispute_status or '-' }}</td>
                    <td>{{ client.current_dispute_round or 0 }}</td>
                    <td>{{ client.created_at.strftime('%b %d, %Y') if client.created_at else 'N/A' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
            <circle cx="9" cy="7" r="4"/>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
        </svg>
        <p>No clients yet</p>
        <span>Clients assigned to your organization will appear here</span>
    </div>
    {% endif %}
</div>

<style>
.header-row {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.stats-grid.mini {
    grid-template-columns: repeat(4, 1fr);
    margin-bottom: 20px;
}

.stats-grid.mini .stat-card {
    padding: 16px 20px;
}

.stats-grid.mini .stat-value {
    font-size: 24px;
}

@media (max-width: 768px) {
    .stats-grid.mini {
        grid-template-columns: repeat(2, 1fr);
    }
}

.filters-bar {
    display: flex;
    gap: 16px;
    align-items: center;
}

.search-box {
    flex: 1;
    position: relative;
}

.search-box svg {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--theme-text-secondary, #9ca3af);
}

.search-box input {
    padding-left: 44px;
}

.badge-error {
    background: rgba(239, 68, 68, 0.1);
    color: #dc2626;
}

.empty-state {
    text-align: center;
    padding: 60px 20px;
    color: var(--theme-text-secondary, #6b7280);
}

.empty-state svg {
    width: 64px;
    height: 64px;
    margin-bottom: 20px;
    opacity: 0.5;
}

.empty-state p {
    font-weight: 600;
    font-size: 18px;
    margin-bottom: 8px;
    color: var(--theme-text-primary, #374151);
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Search filter
document.getElementById('searchInput').addEventListener('input', filterClients);
document.getElementById('statusFilter').addEventListener('change', filterClients);

function filterClients() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const status = document.getElementById('statusFilter').value;
    const rows = document.querySelectorAll('#clientsTable tbody tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        const rowStatus = row.dataset.status;

        const matchesSearch = text.includes(search);
        const matchesStatus = !status || rowStatus === status;

        row.style.display = matchesSearch && matchesStatus ? '' : 'none';
    });
}
</script>
{% endblock %}
