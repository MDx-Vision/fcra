{% extends "portal/base_portal.html" %}
{% set active_tab = 'documents' %}
{% block title %}Documents{% endblock %}
{% block content %}

<!-- Header -->
<div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;" data-testid="page-header">
    <div class="animate-fade-in">
        <h2 style="font-family: 'Playfair Display', serif; font-size: 32px; font-weight: 600; color: #1e3a5f; margin: 0 0 8px 0;" data-testid="page-title">Documents</h2>
        <p style="font-size: 15px; color: #6b7280; margin: 0;">Upload bureau responses and download your case materials.</p>
    </div>
</div>

<!-- Alert -->
<div class="card animate-fade-in-up" data-delay="200" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 1px solid #f59e0b; margin-bottom: 24px;" data-testid="alert-card">
    <div style="display: flex; align-items: flex-start; gap: 16px; flex-wrap: wrap;">
        <div style="font-size: 24px;">âš¡</div>
        <div style="flex: 1; min-width: 200px;">
            <h4 style="font-size: 16px; font-weight: 600; color: #92400e; margin: 0 0 4px 0;">Received mail from a credit bureau?</h4>
            <p style="font-size: 14px; color: #a16207; margin: 0; line-height: 1.5;">Upload it immediately! Every response is critical documentation for your case. Don't throw anything away.</p>
        </div>
    </div>
</div>

<!-- Documents List -->
<div class="card animate-fade-in-up" data-delay="300" style="margin-bottom: 24px;" data-testid="documents-list">
    <div class="card-title" data-testid="documents-title">ğŸ“ Your Case Documents</div>
    <p style="color: #6b7280; margin-bottom: 20px;">Download your dispute letters, analysis reports, and uploaded documents.</p>

    <div style="display: flex; flex-direction: column; gap: 12px;">
        {% for doc in documents %}
        <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: #f9fafb; border-radius: 10px; border: 1px solid #e5e7eb; flex-wrap: wrap;">
            <div style="width: 48px; height: 48px; border-radius: 10px; background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <span style="font-size: 20px;">ğŸ“„</span>
            </div>
            <div style="flex: 1; min-width: 150px;">
                <div style="font-size: 15px; font-weight: 600; color: #1e3a5f; margin-bottom: 2px;">{{ doc.name }}</div>
                <div style="font-size: 13px; color: #6b7280;">{{ doc.created_at.strftime('%B %d, %Y') if doc.created_at else 'N/A' }}</div>
            </div>
            <a href="{{ url_for('portal.download_document', doc_id=doc.id) }}" style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; background: white; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; font-weight: 500; color: #4b5563; cursor: pointer; text-decoration: none;">â¬‡ï¸ Download</a>
        </div>
        {% else %}
        <p style="text-align: center; color: #6b7280; padding: 32px;">No documents yet. Upload your first document below!</p>
        {% endfor %}
    </div>
</div>

<!-- Upload Section -->
<div class="card animate-fade-in-up" data-delay="400" style="margin-bottom: 24px;" data-testid="upload-section">
    <div class="card-title" data-testid="upload-title">ğŸ“¤ Upload Documents</div>
    <p style="color: #6b7280; margin-bottom: 24px;">Select document type and upload files related to your case.</p>

    <form action="{{ url_for('portal.upload_document') }}" method="POST" enctype="multipart/form-data" data-testid="upload-form">
        
        <!-- Document Types -->
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 24px;" class="stats-grid-responsive" data-testid="doc-type-options">
            <label style="display: flex; flex-direction: column; align-items: center; padding: 20px 16px; background: rgba(13, 148, 136, 0.05); border: 2px solid #0d9488; border-radius: 12px; cursor: pointer;">
                <input type="radio" name="doc_type" value="cra_response" checked style="display: none;">
                <span style="font-size: 28px; margin-bottom: 8px;">ğŸ“©</span>
                <span style="font-size: 14px; font-weight: 600; color: #1e3a5f; text-align: center;">CRA Response</span>
                <span style="font-size: 12px; color: #6b7280; text-align: center;">Bureau letters</span>
            </label>
            <label style="display: flex; flex-direction: column; align-items: center; padding: 20px 16px; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer;">
                <input type="radio" name="doc_type" value="collection_letter" style="display: none;">
                <span style="font-size: 28px; margin-bottom: 8px;">ğŸ’¸</span>
                <span style="font-size: 14px; font-weight: 600; color: #1e3a5f; text-align: center;">Collection Letter</span>
                <span style="font-size: 12px; color: #6b7280; text-align: center;">Debt notices</span>
            </label>
            <label style="display: flex; flex-direction: column; align-items: center; padding: 20px 16px; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer;">
                <input type="radio" name="doc_type" value="credit_report" style="display: none;">
                <span style="font-size: 28px; margin-bottom: 8px;">ğŸ“Š</span>
                <span style="font-size: 14px; font-weight: 600; color: #1e3a5f; text-align: center;">Credit Report</span>
                <span style="font-size: 12px; color: #6b7280; text-align: center;">New reports</span>
            </label>
            <label style="display: flex; flex-direction: column; align-items: center; padding: 20px 16px; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer;">
                <input type="radio" name="doc_type" value="legal_document" style="display: none;">
                <span style="font-size: 28px; margin-bottom: 8px;">âš–ï¸</span>
                <span style="font-size: 14px; font-weight: 600; color: #1e3a5f; text-align: center;">Legal Document</span>
                <span style="font-size: 12px; color: #6b7280; text-align: center;">Lawsuits, etc.</span>
            </label>
            <label style="display: flex; flex-direction: column; align-items: center; padding: 20px 16px; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer;">
                <input type="radio" name="doc_type" value="id_proof" style="display: none;">
                <span style="font-size: 28px; margin-bottom: 8px;">ğŸªª</span>
                <span style="font-size: 14px; font-weight: 600; color: #1e3a5f; text-align: center;">ID / Proof</span>
                <span style="font-size: 12px; color: #6b7280; text-align: center;">Identity docs</span>
            </label>
            <label style="display: flex; flex-direction: column; align-items: center; padding: 20px 16px; background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; cursor: pointer;">
                <input type="radio" name="doc_type" value="other" style="display: none;">
                <span style="font-size: 28px; margin-bottom: 8px;">ğŸ“</span>
                <span style="font-size: 14px; font-weight: 600; color: #1e3a5f; text-align: center;">Other</span>
                <span style="font-size: 12px; color: #6b7280; text-align: center;">Anything else</span>
            </label>
        </div>

        <!-- Drop Zone -->
        <div style="border: 2px dashed #d1d5db; border-radius: 16px; padding: 48px 24px; text-align: center; background: #f9fafb; cursor: pointer; transition: all 0.2s ease;" data-testid="drop-zone">
            <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“„</div>
            <p style="font-size: 16px; font-weight: 600; color: #1e3a5f; margin: 0 0 8px 0;">
                <label for="document" style="color: #0d9488; text-decoration: underline; cursor: pointer;">Click to upload</label> or drag and drop
            </p>
            <p style="font-size: 14px; color: #9ca3af; margin: 0;">PDF, JPG, or PNG (max 20MB)</p>
            <input type="file" id="document" name="document" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
        </div>

        <!-- Notes -->
        <div style="margin-top: 20px;">
            <label style="display: block; font-size: 14px; font-weight: 600; color: #1e3a5f; margin-bottom: 8px;">Notes (optional)</label>
            <textarea name="notes" style="width: 100%; padding: 12px 16px; border: 1px solid #e5e7eb; border-radius: 10px; font-size: 14px; resize: vertical; min-height: 80px;" placeholder="Any additional details about this document..."></textarea>
        </div>

        <!-- Submit -->
        <div style="margin-top: 20px;">
            <button type="submit" class="submit-btn" style="width: 100%;">Upload Document</button>
        </div>
    </form>
</div>

<!-- Mobile Scanner -->
<div class="card animate-fade-in-up" data-delay="500" style="background: linear-gradient(135deg, #0a2540 0%, #1e3a5f 100%); text-align: center; padding: 32px; border: none;" data-testid="mobile-scanner">
    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“±</div>
    <h4 style="font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 600; color: white; margin: 0 0 12px 0;">Scan with Your Phone</h4>
    <p style="font-size: 15px; color: #9ca3af; margin: 0 0 24px 0; line-height: 1.5;">Use your phone's camera to scan documents instantly. Perfect for CRA responses and collection letters.</p>
</div>

<script>
// Handle document type selection styling
document.querySelectorAll('input[name="doc_type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        document.querySelectorAll('input[name="doc_type"]').forEach(r => {
            r.parentElement.style.background = '#f9fafb';
            r.parentElement.style.borderColor = '#e5e7eb';
        });
        if (this.checked) {
            this.parentElement.style.background = 'rgba(13, 148, 136, 0.05)';
            this.parentElement.style.borderColor = '#0d9488';
        }
    });
});

// File input display
document.getElementById('document').addEventListener('change', function() {
    const fileName = this.files[0]?.name;
    if (fileName) {
        this.parentElement.querySelector('p:first-of-type').innerHTML = '<span style="color: #059669;">âœ“ ' + fileName + '</span>';
    }
});
</script>

{% endblock %}
