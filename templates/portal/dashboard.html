{% extends "portal/base_portal.html" %}
{% set active_tab = 'case' %}
{% block title %}My Case{% endblock %}
{% block content %}

<!-- Hero Section -->
<div class="card animate-fade-in" style="background: linear-gradient(135deg, #0a2540 0%, #1e3a5f 100%); color: white; text-align: center; padding: 48px 24px; margin-bottom: 24px; border: none;">
    <p style="font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 3px; color: #14b8a6; margin: 0 0 16px 0;">Your credit. Our fight.</p>
    <h2 style="font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 600; margin: 0 0 24px 0;">Your Case</h2>
    <div style="margin-bottom: 12px;">
        <span style="font-family: 'Playfair Display', serif; font-size: 64px; font-weight: 700; color: #14b8a6;" class="animate-number" data-value="{{ total_violations|default(0) }}" data-prefix="$">$0</span>
    </div>
    <p style="font-size: 16px; opacity: 0.8; margin: 0;">in violations identified</p>
</div>

<!-- Stats Grid -->
<div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;" class="stats-grid-responsive">
    <div class="card animate-fade-in-up" data-delay="100" style="text-align: center; padding: 24px;">
        <div style="font-size: 28px; margin-bottom: 8px;">âš ï¸</div>
        <div style="font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 600; color: #0d9488;" class="animate-number" data-value="{{ disputed_accounts|default(0) }}">0</div>
        <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;">Accounts Disputed</div>
    </div>
    <div class="card animate-fade-in-up" data-delay="200" style="text-align: center; padding: 24px;">
        <div style="font-size: 28px; margin-bottom: 8px;">ğŸ›ï¸</div>
        <div style="font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 600; color: #0d9488;" class="animate-number" data-value="{{ bureau_count|default(3) }}">0</div>
        <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;">Bureaus Notified</div>
    </div>
    <div class="card animate-fade-in-up" data-delay="300" style="text-align: center; padding: 24px;">
        <div style="font-size: 28px; margin-bottom: 8px;">â±ï¸</div>
        <div style="font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 600; color: #0d9488;"><span class="animate-number" data-value="{{ days_until_response|default(0) }}">0</span>d</div>
        <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;">Until Response</div>
    </div>
    <div class="card animate-fade-in-up" data-delay="400" style="text-align: center; padding: 24px;">
        <div style="font-size: 28px; margin-bottom: 8px;">ğŸ›¡ï¸</div>
        <div style="font-family: 'Playfair Display', serif; font-size: 36px; font-weight: 600; color: #0d9488;">{{ current_round|default(1) }}/4</div>
        <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-top: 4px;">Round Progress</div>
        <div style="display: inline-flex; align-items: center; gap: 4px; margin-top: 8px; font-size: 12px; font-weight: 600; color: #059669;">
            ğŸ“ˆ On track
        </div>
    </div>
</div>

<!-- Progress + Action Grid -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 24px;" class="two-col-responsive">

    <!-- Progress Ring Card -->
    <div class="card animate-fade-in-up" data-delay="500" style="padding: 32px; text-align: center;">
        <div class="card-title" style="text-align: left;">ğŸ“Š Case Progress</div>

        <!-- Progress Ring -->
        <div style="position: relative; width: 180px; height: 180px; margin: 24px auto;">
            <svg width="180" height="180" viewBox="0 0 180 180" style="transform: rotate(-90deg);">
                <defs>
                    <linearGradient id="progressGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" stop-color="#2dd4bf" />
                        <stop offset="100%" stop-color="#0d9488" />
                    </linearGradient>
                </defs>
                <circle cx="90" cy="90" r="75" fill="none" stroke="#e5e7eb" stroke-width="12"/>
                <circle
                    class="progress-ring-circle"
                    cx="90" cy="90" r="75"
                    fill="none"
                    stroke="url(#progressGradient)"
                    stroke-width="12"
                    stroke-linecap="round"
                    stroke-dasharray="471.24"
                    stroke-dashoffset="471.24"
                    data-progress="{{ progress_percent|default(25) }}"
                />
            </svg>
            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                <span style="font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 700; color: #1e3a5f;" class="progress-percent-text">0</span><span style="font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 700; color: #1e3a5f;">%</span>
                <div style="font-size: 11px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 1.5px; margin-top: 2px;">Complete</div>
            </div>
        </div>

        <!-- Round Markers -->
        <div style="margin-top: 24px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                {% for i in range(1, 5) %}
                <div style="text-align: center; flex: 1;">
                    <div style="width: 12px; height: 12px; border-radius: 50%; margin: 0 auto 6px; background: {% if i <= current_round|default(1) %}#0d9488{% else %}#d1d5db{% endif %};"></div>
                    <span style="font-size: 11px; color: {% if i <= current_round|default(1) %}#1e3a5f{% else %}#9ca3af{% endif %}; font-weight: {% if i <= current_round|default(1) %}600{% else %}400{% endif %};">R{{ i }}</span>
                </div>
                {% endfor %}
            </div>
            <div style="height: 6px; background: #e5e7eb; border-radius: 3px; overflow: hidden;">
                <div class="progress-bar-fill" style="height: 100%; width: 0%; background: linear-gradient(90deg, #0d9488 0%, #14b8a6 100%); border-radius: 3px; transition: width 1s ease-out;" data-width="{{ progress_percent|default(25) }}"></div>
            </div>
        </div>
    </div>

    <!-- Right Column -->
    <div style="display: flex; flex-direction: column; gap: 16px;">

        <!-- What's Next -->
        <div class="card animate-fade-in-up" data-delay="600" style="padding: 24px; flex: 1;">
            <div style="font-size: 11px; font-weight: 600; color: #9ca3af; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">ğŸ“… What's Next</div>
            <h4 style="font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 600; color: #1e3a5f; margin: 0 0 8px 0;">Bureau response expected</h4>
            <div style="display: inline-block; padding: 8px 16px; background: rgba(13, 148, 136, 0.1); border-radius: 8px;">
                <span style="font-size: 14px; font-weight: 600; color: #0d9488;">{{ days_until_response|default(0) }} days remaining</span>
            </div>
        </div>

        <!-- Action Card -->
        <a href="{{ url_for('portal.documents') }}" class="card animate-fade-in-up" data-delay="700" style="padding: 24px; background: linear-gradient(135deg, #0a2540 0%, #1e3a5f 100%); text-decoration: none; display: block; flex: 1; border: none;">
            <div style="font-size: 11px; font-weight: 600; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 12px;">âš¡ Action Needed</div>
            <h4 style="font-family: 'Playfair Display', serif; font-size: 20px; font-weight: 600; color: white; margin: 0 0 8px 0;">Received a letter?</h4>
            <p style="font-size: 14px; color: #9ca3af; margin: 0 0 16px 0; line-height: 1.5;">Bureau responses strengthen your case. Upload them instantly.</p>
            <div style="display: inline-flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 600; color: #14b8a6;">
                Upload now â†’
            </div>
        </a>
    </div>
</div>

<!-- Score Journey -->
<div class="card animate-fade-in-up" data-delay="800" style="margin-bottom: 24px;">
    <div class="card-title">ğŸ“ˆ Your Credit Score Journey</div>
    <p style="color: #6b7280; margin-bottom: 24px;">Track your progress as we work to remove inaccurate items from your report.</p>

    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;" class="stats-grid-responsive">
        <div style="background: linear-gradient(135deg, #fef2f2 0%, #fecaca 100%); border-radius: 12px; padding: 24px; text-align: center;">
            <div style="font-size: 12px; color: #991b1b; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Starting Score</div>
            <div style="font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 700; color: #dc2626;">{{ starting_score|default('--') }}</div>
        </div>
        <div style="background: linear-gradient(135deg, rgba(13, 148, 136, 0.1) 0%, rgba(13, 148, 136, 0.2) 100%); border-radius: 12px; padding: 24px; text-align: center;">
            <div style="font-size: 12px; color: #0f766e; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Current Score</div>
            <div style="font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 700; color: #0d9488;">{{ current_score|default('--') }}</div>
        </div>
        <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border-radius: 12px; padding: 24px; text-align: center;">
            <div style="font-size: 12px; color: #1e40af; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">Points Gained</div>
            <div style="font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 700; color: #2563eb;">{% if starting_score and current_score %}+{{ current_score - starting_score }}{% else %}--{% endif %}</div>
        </div>
    </div>
</div>

<!-- Timeline -->
<div class="card animate-fade-in-up" data-delay="900">
    <div class="card-title">ğŸ—“ï¸ Your Dispute Journey</div>
    <p style="color: #6b7280; margin-bottom: 24px;">Every step we're taking to restore your credit.</p>

    <div class="timeline-vertical">
        <!-- Step 1: Complete -->
        <div style="display: flex; gap: 20px; margin-bottom: 0;">
            <div style="display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: rgba(5, 150, 105, 0.15); border: 3px solid #059669; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #059669; font-size: 14px;">âœ“</span>
                </div>
                <div style="width: 3px; flex: 1; min-height: 40px; margin-top: -2px; background: #059669; border-radius: 2px;"></div>
            </div>
            <div style="flex: 1; padding-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; flex-wrap: wrap; gap: 8px;">
                    <h4 style="font-size: 16px; font-weight: 600; color: #1e3a5f; margin: 0;">Credit report received</h4>
                    <span style="font-size: 13px; font-weight: 500; color: #9ca3af;">Completed</span>
                </div>
                <p style="font-size: 14px; color: #6b7280; margin: 0;">All 3 bureau reports analyzed</p>
            </div>
        </div>

        <!-- Step 2: Analysis -->
        <div style="display: flex; gap: 20px; margin-bottom: 0;">
            <div style="display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: {% if current_round|default(1) >= 1 %}rgba(5, 150, 105, 0.15){% else %}white{% endif %}; border: 3px solid {% if current_round|default(1) >= 1 %}#059669{% else %}#d1d5db{% endif %}; display: flex; align-items: center; justify-content: center;">
                    {% if current_round|default(1) >= 1 %}<span style="color: #059669; font-size: 14px;">âœ“</span>{% endif %}
                </div>
                <div style="width: 3px; flex: 1; min-height: 40px; margin-top: -2px; background: {% if current_round|default(1) >= 1 %}#059669{% else %}#e5e7eb{% endif %}; border-radius: 2px;"></div>
            </div>
            <div style="flex: 1; padding-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; flex-wrap: wrap; gap: 8px;">
                    <h4 style="font-size: 16px; font-weight: 600; color: #1e3a5f; margin: 0;">Analysis complete</h4>
                    <span style="font-size: 13px; font-weight: 500; color: #9ca3af;">{{ disputed_accounts|default(0) }} violations identified</span>
                </div>
                <p style="font-size: 14px; color: #6b7280; margin: 0;">${{ "{:,.0f}".format(total_violations|default(0)) }} exposure documented</p>
            </div>
        </div>

        <!-- Step 3: Letters Sent -->
        <div style="display: flex; gap: 20px; margin-bottom: 0;">
            <div style="display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: {% if current_round|default(1) >= 1 %}rgba(5, 150, 105, 0.15){% else %}white{% endif %}; border: 3px solid {% if current_round|default(1) >= 1 %}#059669{% else %}#d1d5db{% endif %}; display: flex; align-items: center; justify-content: center;">
                    {% if current_round|default(1) >= 1 %}<span style="color: #059669; font-size: 14px;">âœ“</span>{% endif %}
                </div>
                <div style="width: 3px; flex: 1; min-height: 40px; margin-top: -2px; background: {% if current_round|default(1) >= 2 %}#059669{% else %}#e5e7eb{% endif %}; border-radius: 2px;"></div>
            </div>
            <div style="flex: 1; padding-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; flex-wrap: wrap; gap: 8px;">
                    <h4 style="font-size: 16px; font-weight: 600; color: #1e3a5f; margin: 0;">Dispute letters sent</h4>
                    <span style="font-size: 13px; font-weight: 500; color: #9ca3af;">Round {{ current_round|default(1) }}</span>
                </div>
                <p style="font-size: 14px; color: #6b7280; margin: 0;">Certified mail to bureaus</p>
            </div>
        </div>

        <!-- Step 4: Current -->
        <div style="display: flex; gap: 20px; margin-bottom: 0;">
            <div style="display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: #0d9488; border: 3px solid #0d9488; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite;">
                    <div style="width: 10px; height: 10px; border-radius: 50%; background: white;"></div>
                </div>
                <div style="width: 3px; flex: 1; min-height: 40px; margin-top: -2px; background: #e5e7eb; border-radius: 2px;"></div>
            </div>
            <div style="flex: 1; padding-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; flex-wrap: wrap; gap: 8px;">
                    <h4 style="font-size: 16px; font-weight: 600; color: #1e3a5f; margin: 0;">Awaiting responses</h4>
                    <span style="font-size: 13px; font-weight: 500; color: #0d9488;">In progress</span>
                </div>
                <p style="font-size: 14px; color: #6b7280; margin: 0;">{{ days_until_response|default(0) }} days until deadline</p>
            </div>
        </div>

        <!-- Step 5: Future -->
        <div style="display: flex; gap: 20px; margin-bottom: 0;">
            <div style="display: flex; flex-direction: column; align-items: center; width: 40px; flex-shrink: 0;">
                <div style="width: 32px; height: 32px; border-radius: 50%; background: white; border: 3px solid #d1d5db;"></div>
            </div>
            <div style="flex: 1; padding-bottom: 0;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 4px; flex-wrap: wrap; gap: 8px;">
                    <h4 style="font-size: 16px; font-weight: 600; color: #9ca3af; margin: 0;">Review & escalate</h4>
                    <span style="font-size: 13px; font-weight: 500; color: #9ca3af;">Pending</span>
                </div>
                <p style="font-size: 14px; color: #9ca3af; margin: 0;">Next round preparation if needed</p>
            </div>
        </div>
    </div>

    <!-- View Detailed Status Link -->
    <div style="margin-top: 24px; padding-top: 20px; border-top: 1px solid #e5e7eb; text-align: center;">
        <a href="{{ url_for('portal.status') }}" style="display: inline-flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 600; color: #0d9488; text-decoration: none; cursor: pointer;">
            View detailed bureau status â†’
        </a>
    </div>
</div>

<!-- Trust Footer -->
<div style="display: flex; justify-content: center; gap: 40px; margin-top: 32px; padding: 24px 0; border-top: 1px solid #e5e7eb; flex-wrap: wrap;">
    <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: #6b7280;">
        <span style="color: #0d9488;">ğŸ”’</span> Bank-Level Security
    </div>
    <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: #6b7280;">
        <span style="color: #0d9488;">âš–ï¸</span> FCRA Attorney-Backed
    </div>
    <div style="display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: #6b7280;">
        <span style="color: #0d9488;">ğŸ•</span> 24/7 Portal Access
    </div>
</div>

{% endblock %}
