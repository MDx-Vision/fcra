<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Report - {{ client_name }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f172a;
            color: #e2e8f0;
            min-height: 100vh;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%);
            padding: 24px 32px;
            border-bottom: 1px solid #334155;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 600;
            color: white;
        }
        
        .client-info {
            text-align: right;
        }
        
        .client-name {
            font-size: 18px;
            font-weight: 600;
            color: white;
        }
        
        .report-date {
            font-size: 14px;
            color: #94a3b8;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 32px;
        }
        
        .scores-section {
            margin-bottom: 32px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: white;
        }
        
        .scores-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }
        
        .score-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid #334155;
            border-radius: 16px;
            padding: 32px;
            text-align: center;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .score-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.3);
        }
        
        .score-card.transunion { border-top: 4px solid #3b82f6; }
        .score-card.experian { border-top: 4px solid #ef4444; }
        .score-card.equifax { border-top: 4px solid #f59e0b; }
        
        .bureau-logo {
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }
        
        .transunion .bureau-logo { color: #3b82f6; }
        .experian .bureau-logo { color: #ef4444; }
        .equifax .bureau-logo { color: #f59e0b; }
        
        .score-value {
            font-size: 72px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 8px;
        }
        
        .score-good { color: #10b981; }
        .score-fair { color: #f59e0b; }
        .score-poor { color: #ef4444; }
        .score-na { color: #6b7280; font-size: 36px; }
        
        .score-rating {
            font-size: 14px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .personal-info-section {
            margin-bottom: 32px;
        }

        .personal-info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }

        .personal-info-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 16px;
        }

        .personal-info-label {
            font-size: 12px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .personal-info-value {
            font-size: 16px;
            font-weight: 600;
            color: #e2e8f0;
        }

        .summary-section {
            margin-bottom: 32px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }

        .summary-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 10px;
            padding: 14px 10px;
            text-align: center;
        }

        .summary-value {
            font-size: 26px;
            font-weight: 700;
            color: #3b82f6;
        }

        .summary-label {
            font-size: 11px;
            color: #94a3b8;
            margin-top: 4px;
        }
        
        .accounts-section {
            margin-bottom: 32px;
        }
        
        .account-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
        }
        
        .account-header {
            background: #0f172a;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }
        
        .account-header:hover {
            background: #1e293b;
        }
        
        .creditor-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .creditor-name {
            font-weight: 600;
            color: white;
            font-size: 16px;
        }
        
        .account-number {
            font-size: 12px;
            color: #6b7280;
            font-family: monospace;
        }
        
        .account-meta {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .bureau-dots {
            display: flex;
            gap: 6px;
        }
        
        .bureau-dot {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 600;
        }
        
        .bureau-dot.tu { background: #3b82f6; color: white; }
        .bureau-dot.ex { background: #ef4444; color: white; }
        .bureau-dot.eq { background: #f59e0b; color: white; }
        .bureau-dot.inactive { background: #374151; color: #6b7280; }
        
        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .status-open { background: #10b981; color: white; }
        .status-closed { background: #6b7280; color: white; }
        .status-collection { background: #ef4444; color: white; }
        .status-late { background: #f59e0b; color: #000; }
        .status-current { background: #10b981; color: white; }
        
        .account-details {
            padding: 20px;
            display: none;
            border-top: 1px solid #334155;
        }
        
        .account-details.show {
            display: block;
        }
        
        .details-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 20px;
        }
        
        .detail-item {
            background: #0f172a;
            padding: 12px;
            border-radius: 8px;
        }
        
        .detail-label {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 14px;
            color: white;
            font-weight: 500;
        }
        
        .payment-history-section {
            margin-top: 20px;
        }
        
        .payment-history-title {
            font-size: 14px;
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 12px;
        }
        
        .payment-timeline {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
        }
        
        .payment-month {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 36px;
        }
        
        .month-label {
            font-size: 9px;
            color: #6b7280;
            margin-bottom: 4px;
        }
        
        .payment-status {
            width: 28px;
            height: 28px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            font-weight: 600;
        }
        
        .payment-ok { background: #10b981; color: white; }
        .payment-30 { background: #f59e0b; color: #000; }
        .payment-60 { background: #f97316; color: white; }
        .payment-90 { background: #ef4444; color: white; }
        .payment-co { background: #7f1d1d; color: white; }
        .payment-na { background: #374151; color: #6b7280; }
        
        .late-summary {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            padding: 12px;
            background: #0f172a;
            border-radius: 8px;
        }
        
        .late-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }
        
        .late-count {
            font-weight: 600;
        }
        
        .contacts-section {
            margin-bottom: 32px;
        }
        
        .contacts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .contact-card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 16px;
        }
        
        .contact-name {
            font-weight: 600;
            color: white;
            margin-bottom: 8px;
        }
        
        .contact-address {
            font-size: 13px;
            color: #94a3b8;
            margin-bottom: 8px;
            line-height: 1.5;
        }
        
        .contact-phone {
            font-size: 13px;
            color: #3b82f6;
        }
        
        .empty-state {
            text-align: center;
            padding: 48px;
            color: #6b7280;
        }
        
        .print-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        
        .print-btn:hover {
            background: #2563eb;
        }
        
        .back-link {
            color: #3b82f6;
            text-decoration: none;
            font-size: 14px;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .inquiries-section, .collections-section, .public-records-section {
            margin-bottom: 32px;
        }
        
        .card {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 24px;
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .item-list {
            list-style: none;
        }
        
        .item-list li {
            padding: 12px 0;
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .item-list li:last-child {
            border-bottom: none;
        }
        
        .inquiry-bureau {
            font-size: 11px;
            color: #6b7280;
            background: #334155;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        @media print {
            body {
                background: white;
                color: black;
            }
            .header {
                background: white;
                border-bottom: 2px solid #000;
            }
            .score-card, .summary-card, .card, .account-card, .contact-card {
                background: white;
                border: 1px solid #ccc;
            }
            .print-btn, .back-link {
                display: none;
            }
            .account-details {
                display: block !important;
            }
        }
        
        @media (max-width: 768px) {
            .scores-grid {
                grid-template-columns: 1fr;
            }
            .summary-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .details-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .contacts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">BA</div>
                <span class="logo-text">Brightpath Ascend</span>
            </div>
            <div class="client-info">
                <div class="client-name">{{ client_name }}</div>
                <div class="report-date">Report Date: {{ report_date }}</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <a href="/dashboard/credit-import" class="back-link">&larr; Back to Credit Import</a>
            <button class="print-btn" onclick="window.print()">Print Report</button>
        </div>
        
        <section class="scores-section">
            <h2 class="section-title">Credit Scores</h2>
            <div class="scores-grid">
                <div class="score-card transunion">
                    <div class="bureau-logo">TransUnion</div>
                    {% if scores.transunion %}
                        <div class="score-value {% if scores.transunion >= 670 %}score-good{% elif scores.transunion >= 580 %}score-fair{% else %}score-poor{% endif %}">
                            {{ scores.transunion }}
                        </div>
                        <div class="score-rating">
                            {% if scores.transunion >= 800 %}Exceptional{% elif scores.transunion >= 740 %}Very Good{% elif scores.transunion >= 670 %}Good{% elif scores.transunion >= 580 %}Fair{% else %}Poor{% endif %}
                        </div>
                    {% else %}
                        <div class="score-value score-na">N/A</div>
                        <div class="score-rating">Not Available</div>
                    {% endif %}
                </div>
                
                <div class="score-card experian">
                    <div class="bureau-logo">Experian</div>
                    {% if scores.experian %}
                        <div class="score-value {% if scores.experian >= 670 %}score-good{% elif scores.experian >= 580 %}score-fair{% else %}score-poor{% endif %}">
                            {{ scores.experian }}
                        </div>
                        <div class="score-rating">
                            {% if scores.experian >= 800 %}Exceptional{% elif scores.experian >= 740 %}Very Good{% elif scores.experian >= 670 %}Good{% elif scores.experian >= 580 %}Fair{% else %}Poor{% endif %}
                        </div>
                    {% else %}
                        <div class="score-value score-na">N/A</div>
                        <div class="score-rating">Not Available</div>
                    {% endif %}
                </div>
                
                <div class="score-card equifax">
                    <div class="bureau-logo">Equifax</div>
                    {% if scores.equifax %}
                        <div class="score-value {% if scores.equifax >= 670 %}score-good{% elif scores.equifax >= 580 %}score-fair{% else %}score-poor{% endif %}">
                            {{ scores.equifax }}
                        </div>
                        <div class="score-rating">
                            {% if scores.equifax >= 800 %}Exceptional{% elif scores.equifax >= 740 %}Very Good{% elif scores.equifax >= 670 %}Good{% elif scores.equifax >= 580 %}Fair{% else %}Poor{% endif %}
                        </div>
                    {% else %}
                        <div class="score-value score-na">N/A</div>
                        <div class="score-rating">Not Available</div>
                    {% endif %}
                </div>
            </div>
        </section>

        <!-- Personal Information Section -->
        <section class="personal-info-section">
            <h2 class="section-title">Personal Information</h2>
            <div class="personal-info-grid">
                <div class="personal-info-card">
                    <div class="personal-info-label">Full Name</div>
                    <div class="personal-info-value">{{ personal_info.name or 'Not Available' }}</div>
                </div>
                <div class="personal-info-card">
                    <div class="personal-info-label">Address</div>
                    <div class="personal-info-value">{{ personal_info.address or 'Not Available' }}</div>
                </div>
                <div class="personal-info-card">
                    <div class="personal-info-label">Date of Birth</div>
                    <div class="personal-info-value">{{ personal_info.dob or 'Not Available' }}</div>
                </div>
                <div class="personal-info-card">
                    <div class="personal-info-label">SSN Last 4</div>
                    <div class="personal-info-value">{{ personal_info.ssn_last4 or 'Not Available' }}</div>
                </div>
            </div>
        </section>

        <section class="summary-section">
            <h2 class="section-title">Report Summary</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-value">{{ summary.total_accounts or 0 }}</div>
                    <div class="summary-label">Total Accounts</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value">{{ summary.total_inquiries or 0 }}</div>
                    <div class="summary-label">Inquiries</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" style="color: {% if summary.total_collections > 0 %}#ef4444{% else %}#10b981{% endif %}">{{ summary.total_collections or 0 }}</div>
                    <div class="summary-label">Collections</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" style="color: {% if summary.total_public_records > 0 %}#ef4444{% else %}#10b981{% endif %}">{{ summary.total_public_records or 0 }}</div>
                    <div class="summary-label">Public Records</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" style="color: {% if summary.total_late_payments > 0 %}#ef4444{% else %}#10b981{% endif %}">{{ summary.total_late_payments or 0 }}</div>
                    <div class="summary-label">Late Payments</div>
                </div>
            </div>
        </section>
        
        <!-- Analytics Section -->
        <section class="analytics-section" style="margin-bottom: 30px;">
            <h2 class="section-title">Credit Analytics</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-value" style="color: {% if analytics.utilization <= 30 %}#10b981{% elif analytics.utilization <= 50 %}#f59e0b{% else %}#ef4444{% endif %}">
                        {{ analytics.utilization }}%
                    </div>
                    <div class="summary-label">Credit Utilization</div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 5px;">
                        {% if analytics.utilization <= 30 %}Excellent{% elif analytics.utilization <= 50 %}Fair{% else %}High{% endif %}
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" style="color: {% if analytics.payment_score >= 95 %}#10b981{% elif analytics.payment_score >= 80 %}#f59e0b{% else %}#ef4444{% endif %}">
                        {{ analytics.payment_score }}%
                    </div>
                    <div class="summary-label">On-Time Payments</div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 5px;">
                        {{ analytics.on_time_count }} of {{ analytics.total_payments }} months
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" style="color: #3b82f6;">
                        {{ analytics.avg_account_age }}
                    </div>
                    <div class="summary-label">Avg Account Age</div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 5px;">
                        Oldest: {{ analytics.oldest_account }}
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" style="color: #8b5cf6;">
                        {{ analytics.total_balance }}
                    </div>
                    <div class="summary-label">Total Balance</div>
                    <div style="font-size: 11px; color: #6b7280; margin-top: 5px;">
                        Limit: {{ analytics.total_limit }}
                    </div>
                </div>
            </div>
        </section>
        
        {% if accounts %}
        <section class="accounts-section">
            <h2 class="section-title">Trade Lines ({{ accounts|length }})</h2>
            
            <!-- Filter Bar -->
            <div class="filter-bar" style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                <input type="text" id="accountSearch" placeholder="Search creditors..." 
                    style="padding: 10px 15px; border-radius: 8px; border: 1px solid #374151; background: #1f2937; color: white; width: 250px; font-size: 14px;"
                    onkeyup="filterAccounts()">
                <div class="status-filters" style="display: flex; gap: 8px;">
                    <button class="filter-btn active" onclick="setStatusFilter('all', this)" style="padding: 8px 16px; border-radius: 6px; border: none; background: #3b82f6; color: white; cursor: pointer; font-size: 13px;">All</button>
                    <button class="filter-btn" onclick="setStatusFilter('open', this)" style="padding: 8px 16px; border-radius: 6px; border: 1px solid #374151; background: #1f2937; color: #9ca3af; cursor: pointer; font-size: 13px;">Open</button>
                    <button class="filter-btn" onclick="setStatusFilter('closed', this)" style="padding: 8px 16px; border-radius: 6px; border: 1px solid #374151; background: #1f2937; color: #9ca3af; cursor: pointer; font-size: 13px;">Closed</button>
                    <button class="filter-btn" onclick="setStatusFilter('negative', this)" style="padding: 8px 16px; border-radius: 6px; border: 1px solid #374151; background: #1f2937; color: #9ca3af; cursor: pointer; font-size: 13px;">Negative</button>
                    <button class="filter-btn" onclick="setStatusFilter('au', this)" style="padding: 8px 16px; border-radius: 6px; border: 1px solid #374151; background: #1f2937; color: #9ca3af; cursor: pointer; font-size: 13px;">AU</button>
                    <button class="filter-btn" onclick="setStatusFilter('discrepancy', this)" style="padding: 8px 16px; border-radius: 6px; border: 1px solid #374151; background: #1f2937; color: #f59e0b; cursor: pointer; font-size: 13px;">⚠ Discrepancy</button>
                    
                </div>
                <span id="filterCount" style="color: #9ca3af; font-size: 13px;"></span>
            </div>
            
            {% for account in accounts %}
            <div class="account-card">
                <div class="account-header" onclick="toggleDetails(this)">
                    <div class="creditor-info">
                        <div class="creditor-name">{{ account.creditor }}{% if account.is_authorized_user %}<span style="background: #8b5cf6; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">AU</span>{% endif %}{% if 'closed' in (account.status|lower) or 'terminated' in (account.status|lower) or (account.status|lower) == 'paid' or 'paid satisf' in (account.status|lower) %}<span style="background: #6b7280; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">CLOSED</span>{% elif 'paying' in (account.status|lower) or 'current' in (account.status|lower) or 'open' in (account.status|lower) or 'agreed' in (account.status|lower) or 'past due' in (account.status|lower) or 'late' in (account.status|lower) %}<span style="background: #10b981; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">OPEN</span>{% endif %}{% if 'past due' in (account.status|lower) or 'late' in (account.status|lower) or 'collection' in (account.status|lower) or 'charge' in (account.status|lower) or 'delinq' in (account.status|lower) %}<span style="background: #ef4444; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">NEGATIVE</span>{% endif %}{% if account.has_discrepancy %}<span style="background: #f59e0b; color: white; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 8px;">⚠ DISCREPANCY</span>{% endif %}</div>
                        {% if account.account_number %}
                        <div class="account-number">Account #: {{ account.account_number }}</div>
                        {% endif %}
                    </div>
                    <div class="account-meta">
                        <span class="status-badge {% if 'past due' in (account.status|lower) or 'late' in (account.status|lower) %}status-late{% elif 'paid' in (account.status|lower) or 'agreed' in (account.status|lower) %}status-current{% else %}status-open{% endif %}">
                            {{ account.status or 'Unknown' }}
                        </span>
                        <div class="bureau-dots">
                            <span class="bureau-dot {% if account.bureaus.transunion.present %}tu{% else %}inactive{% endif %}" onclick="event.stopPropagation(); filterBureau('tu', this)" style="cursor: pointer;">TU</span>
                            <span class="bureau-dot {% if account.bureaus.experian.present %}ex{% else %}inactive{% endif %}" onclick="event.stopPropagation(); filterBureau('ex', this)" style="cursor: pointer;">EX</span>
                            <span class="bureau-dot {% if account.bureaus.equifax.present %}eq{% else %}inactive{% endif %}" onclick="event.stopPropagation(); filterBureau('eq', this)" style="cursor: pointer;">EQ</span>
                        </div>
                    </div>
                </div>
                <div class="account-details">
                    <div class="details-grid">
                        <div class="detail-item">
                            <div class="detail-label">Account Type</div>
                            <div class="detail-value">{{ account.account_type_detail or account.account_type or 'N/A' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Balance</div>
                            <div class="detail-value bureau-value" data-field="balance" data-tu="{{ account.bureaus.transunion.balance or '' }}" data-ex="{{ account.bureaus.experian.balance or '' }}" data-eq="{{ account.bureaus.equifax.balance or '' }}">{{ account.balance or 'N/A' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Credit Limit</div>
                            <div class="detail-value bureau-value" data-field="credit_limit" data-tu="{{ account.bureaus.transunion.credit_limit or '' }}" data-ex="{{ account.bureaus.experian.credit_limit or '' }}" data-eq="{{ account.bureaus.equifax.credit_limit or '' }}">{{ account.credit_limit or 'N/A' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Monthly Payment</div>
                            <div class="detail-value">{{ account.monthly_payment or 'N/A' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Date Opened</div>
                            <div class="detail-value bureau-value" data-field="date_opened" data-tu="{{ account.bureaus.transunion.date_opened or '' }}" data-ex="{{ account.bureaus.experian.date_opened or '' }}" data-eq="{{ account.bureaus.equifax.date_opened or '' }}">{{ account.date_opened or 'N/A' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">High Balance</div>
                            <div class="detail-value">{{ account.high_balance or 'N/A' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Past Due</div>
                            <div class="detail-value" style="color: {% if account.past_due_amount and account.past_due_amount != '$0.00' %}#ef4444{% else %}#10b981{% endif %}">{{ account.past_due_amount or '$0.00' }}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Date Reported</div>
                            <div class="detail-value">{{ account.date_reported or 'N/A' }}</div>
                        </div>
                    </div>
                    
                    {% if account.payment_history %}
                    <div class="payment-history-section">
                        <div class="payment-history-title">Payment History ({{ account.payment_history|length }} months) <span class="bureau-filter-label" style="font-size: 11px; color: #6b7280; margin-left: 10px;">Showing: All Bureaus</span></div>

                        <!-- TransUnion Row -->
                        <div class="bureau-payment-row" data-bureau="tu">
                            <div class="bureau-row-label" style="color: #3b82f6; font-weight: 600; font-size: 12px; margin-bottom: 6px;">TransUnion</div>
                            <div class="payment-timeline">
                                {% for entry in account.payment_history[:24] %}
                                <div class="payment-month">
                                    <div class="month-label">{{ entry.month[:3] }}</div>
                                    <div class="payment-status {% if entry.transunion == 'OK' %}payment-ok{% elif entry.transunion == '30' %}payment-30{% elif entry.transunion == '60' %}payment-60{% elif entry.transunion == '90' %}payment-90{% elif entry.transunion == '120' %}payment-co{% elif 'CO' in (entry.transunion or '') %}payment-co{% else %}payment-na{% endif %}">
                                        {{ entry.transunion or '-' }}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Experian Row -->
                        <div class="bureau-payment-row" data-bureau="ex" style="margin-top: 12px;">
                            <div class="bureau-row-label" style="color: #ef4444; font-weight: 600; font-size: 12px; margin-bottom: 6px;">Experian</div>
                            <div class="payment-timeline">
                                {% for entry in account.payment_history[:24] %}
                                <div class="payment-month">
                                    <div class="month-label">{{ entry.month[:3] }}</div>
                                    <div class="payment-status {% if entry.experian == 'OK' %}payment-ok{% elif entry.experian == '30' %}payment-30{% elif entry.experian == '60' %}payment-60{% elif entry.experian == '90' %}payment-90{% elif entry.experian == '120' %}payment-co{% elif 'CO' in (entry.experian or '') %}payment-co{% else %}payment-na{% endif %}">
                                        {{ entry.experian or '-' }}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Equifax Row -->
                        <div class="bureau-payment-row" data-bureau="eq" style="margin-top: 12px;">
                            <div class="bureau-row-label" style="color: #f59e0b; font-weight: 600; font-size: 12px; margin-bottom: 6px;">Equifax</div>
                            <div class="payment-timeline">
                                {% for entry in account.payment_history[:24] %}
                                <div class="payment-month">
                                    <div class="month-label">{{ entry.month[:3] }}</div>
                                    <div class="payment-status {% if entry.equifax == 'OK' %}payment-ok{% elif entry.equifax == '30' %}payment-30{% elif entry.equifax == '60' %}payment-60{% elif entry.equifax == '90' %}payment-90{% elif entry.equifax == '120' %}payment-co{% elif 'CO' in (entry.equifax or '') %}payment-co{% else %}payment-na{% endif %}">
                                        {{ entry.equifax or '-' }}
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        <div class="late-summary">
                            <div class="late-item">
                                <span class="payment-status payment-30" style="width:20px;height:20px;font-size:8px;">30</span>
                                <span>30 Days Late: <span class="late-count">{{ account.times_30_late or '0' }}</span></span>
                            </div>
                            <div class="late-item">
                                <span class="payment-status payment-60" style="width:20px;height:20px;font-size:8px;">60</span>
                                <span>60 Days Late: <span class="late-count">{{ account.times_60_late or '0' }}</span></span>
                            </div>
                            <div class="late-item">
                                <span class="payment-status payment-90" style="width:20px;height:20px;font-size:8px;">90</span>
                                <span>90+ Days Late: <span class="late-count">{{ account.times_90_late or '0' }}</span></span>
                            </div>
                        </div>
                        {% if account.has_discrepancy %}
                        <div class="discrepancy-details" style="margin-top: 15px; padding: 12px; background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 8px;">
                            <div style="color: #f59e0b; font-weight: 600; margin-bottom: 8px;">⚠ Bureau Discrepancies Detected</div>
                            {% for disc in account.discrepancies %}
                            <div style="margin-bottom: 8px;">
                                <span style="color: #9ca3af;">{{ disc.field }}:</span>
                                <div style="display: flex; gap: 15px; margin-top: 4px;">
                                    {% if 'transunion' in disc.bureau_values %}<span style="color: #3b82f6;">TU: ${{ disc.bureau_values['transunion'] }}</span>{% endif %}
                                    {% if 'experian' in disc.bureau_values %}<span style="color: #ef4444;">EX: ${{ disc.bureau_values['experian'] }}</span>{% endif %}
                                    {% if 'equifax' in disc.bureau_values %}<span style="color: #10b981;">EQ: ${{ disc.bureau_values['equifax'] }}</span>{% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </section>
        {% endif %}
        
        {% if inquiries %}
        <section class="inquiries-section">
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Recent Inquiries ({{ inquiries|length }})</h3>
                </div>
                <ul class="item-list">
                    {% for inquiry in inquiries %}
                    <li>
                        <span>
                            {{ inquiry.creditor or 'Unknown Creditor' }}
                            {% if inquiry.bureau %}
                            <span class="inquiry-bureau">{{ inquiry.bureau }}</span>
                            {% endif %}
                        </span>
                        <span style="color: #6b7280;">{{ inquiry.date }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </section>
        {% endif %}
        
        {% if creditor_contacts %}
        <section class="contacts-section">
            <h2 class="section-title">Creditor Contacts ({{ creditor_contacts|length }})</h2>
            <div class="contacts-grid">
                {% for contact in creditor_contacts %}
                <div class="contact-card">
                    <div class="contact-name">{{ contact.creditor }}</div>
                    {% if contact.address %}
                    <div class="contact-address">{{ contact.address }}</div>
                    {% endif %}
                    {% if contact.phone %}
                    <div class="contact-phone">{{ contact.phone }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}
        
        {% if collections %}
        <section class="collections-section">
            <div class="card" style="border-left: 4px solid #ef4444;">
                <div class="card-header">
                    <h3 class="card-title" style="color: #ef4444;">Collections ({{ collections|length }})</h3>
                </div>
                <ul class="item-list">
                    {% for collection in collections %}
                    <li>
                        <div>
                            <div style="font-weight: 600;">{{ collection.agency }}</div>
                            {% if collection.original_creditor and collection.original_creditor != 'Unknown' %}
                            <div style="font-size: 12px; color: #6b7280;">Original: {{ collection.original_creditor }}</div>
                            {% endif %}
                        </div>
                        <span style="color: #ef4444; font-weight: 600;">{{ collection.amount }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </section>
        {% endif %}
        
        {% if public_records %}
        <section class="public-records-section">
            <div class="card" style="border-left: 4px solid #f59e0b;">
                <div class="card-header">
                    <h3 class="card-title" style="color: #f59e0b;">Public Records ({{ public_records|length }})</h3>
                </div>
                <ul class="item-list">
                    {% for record in public_records %}
                    <li>
                        <span>{{ record.type }}</span>
                        <span style="color: #6b7280;">{{ record.date or record.status }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </section>
        {% endif %}
        
        <div style="text-align: center; padding: 32px; color: #6b7280; font-size: 12px;">
            <p>This report was imported from {{ service_name }} on {{ report_date }}</p>
            <p>Brightpath Ascend FCRA Platform</p>
        </div>
    </div>
    
    <script>
            function toggleDetails(header) {
                const details = header.nextElementSibling;
                details.classList.toggle('show');
            }

            function filterBureau(bureau, dot) {
                const card = dot.closest('.account-card');
                const details = card.querySelector('.account-details');
                if (!details.classList.contains('show')) {
                    details.classList.add('show');
                }

                const allDots = card.querySelectorAll('.bureau-dot');
                const bureauRows = card.querySelectorAll('.bureau-payment-row');
                const filterLabel = card.querySelector('.bureau-filter-label');
                const bureauNames = {'tu': 'TransUnion', 'ex': 'Experian', 'eq': 'Equifax'};

                // Check if this bureau is already selected (toggle off to show all)
                const isAlreadySelected = dot.style.outline === '2px solid white';

                if (isAlreadySelected) {
                    // Reset to show ALL bureaus
                    allDots.forEach(d => d.style.outline = 'none');
                    bureauRows.forEach(row => row.style.display = 'block');
                    if (filterLabel) filterLabel.textContent = 'Showing: All Bureaus';

                    // Reset account detail fields to show combined/first value
                    const bureauValues = card.querySelectorAll('.bureau-value');
                    bureauValues.forEach(bv => {
                        const tu = bv.dataset.tu || '';
                        const ex = bv.dataset.ex || '';
                        const eq = bv.dataset.eq || '';
                        bv.textContent = tu || ex || eq || 'N/A';
                    });
                } else {
                    // Show ONLY selected bureau
                    allDots.forEach(d => d.style.outline = 'none');
                    dot.style.outline = '2px solid white';

                    // Hide other bureau rows, show selected one
                    bureauRows.forEach(row => {
                        if (row.dataset.bureau === bureau) {
                            row.style.display = 'block';
                        } else {
                            row.style.display = 'none';
                        }
                    });

                    if (filterLabel) filterLabel.textContent = 'Showing: ' + bureauNames[bureau] + ' only';

                    // Update account detail fields (Balance, Credit Limit, Date Opened)
                    const bureauValues = card.querySelectorAll('.bureau-value');
                    bureauValues.forEach(bv => {
                        const val = bv.dataset[bureau] || '';
                        bv.textContent = val || 'N/A';
                    });
                }

                // Highlight discrepancy values for selected bureau
                const discSpans = card.querySelectorAll('.discrepancy-details span[style*="color"]');
                discSpans.forEach(span => {
                    span.style.fontWeight = 'normal';
                    span.style.textDecoration = 'none';
                });
                if (!isAlreadySelected) {
                    const bureauColors = {'tu': '#3b82f6', 'ex': '#ef4444', 'eq': '#10b981'};
                    discSpans.forEach(span => {
                        if (span.style.color === bureauColors[bureau] ||
                            span.textContent.toLowerCase().startsWith(bureau.toUpperCase().substring(0,2))) {
                            span.style.fontWeight = 'bold';
                            span.style.textDecoration = 'underline';
                        }
                    });
                }
            }

            // Filter state (dispute functions removed) for flagged accounts
            function generateDisputeLetters() {
                const flaggedBtns = document.querySelectorAll('.flag-dispute-btn.flagged');
                if (flaggedBtns.length === 0) {
                    alert('No accounts flagged for dispute. Click the Flag button on accounts you want to dispute.');
                    return;
                }
                
                const accounts = [];
                flaggedBtns.forEach(btn => {
                    const card = btn.closest('.account-card');
                    const creditorEl = card.querySelector('.creditor-name');
                    let creditor = creditorEl.childNodes[0].textContent.trim();
                    const accountNumEl = card.querySelector('.account-number');
                    const accountNum = accountNumEl ? accountNumEl.textContent.replace('Account #:', '').trim() : 'N/A';
                    const balanceEl = card.querySelector('.bureau-value[data-field="balance"]');
                    const balance = balanceEl ? balanceEl.textContent.trim() : 'N/A';
                    const statusEl = card.querySelector('.status-badge');
                    const status = statusEl ? statusEl.textContent.trim() : 'N/A';
                    
                    accounts.push({ creditor, accountNum, balance, status });
                });
                
                const clientName = document.querySelector('h1')?.textContent.replace('Credit Report -', '').trim() || 'Client';
                const today = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                
                let letter = 'DISPUTE LETTER - FAIR CREDIT REPORTING ACT\n\n';
                letter += 'Date: ' + today + '\n';
                letter += 'Client: ' + clientName + '\n\n';
                letter += 'To: [Credit Bureau Name]\n';
                letter += '    [Bureau Address]\n\n';
                letter += 'Re: Dispute of Inaccurate Credit Information\n\n';
                letter += 'Dear Sir/Madam,\n\n';
                letter += 'I am writing pursuant to my rights under the Fair Credit Reporting Act, 15 U.S.C. § 1681 et seq., to dispute the following inaccurate information appearing on my credit report:\n\n';
                letter += 'DISPUTED ACCOUNTS:\n';
                letter += '==================\n';
                
                accounts.forEach((acct, i) => {
                    letter += '\n' + (i + 1) + '. Creditor: ' + acct.creditor + '\n';
                    letter += '   Account Number: ' + acct.accountNum + '\n';
                    letter += '   Balance Reported: ' + acct.balance + '\n';
                    letter += '   Status: ' + acct.status + '\n';
                    letter += '   Reason for Dispute: [Please verify the accuracy of this account]\n';
                });
                
                letter += '\n==================\n\n';
                letter += 'Under the FCRA, you are required to conduct a reasonable investigation into this dispute within 30 days and provide me with the results. If you cannot verify this information, you must delete it from my credit file.\n\n';
                letter += 'Please send me written notification of the results of your investigation.\n\n';
                letter += 'Sincerely,\n\n';
                letter += '_______________________\n';
                letter += clientName + '\n';
                
                const win = window.open('', '_blank');
                win.document.write('<html><head><title>Dispute Letter</title>');
                win.document.write('<style>body{font-family:Courier,monospace;white-space:pre-wrap;padding:40px;line-height:1.6;max-width:800px;margin:0 auto;}@media print{body{padding:20px;}}</style>');
                win.document.write('</head><body>');
                win.document.write(letter);
                win.document.write('</body></html>');
                win.document.close();
            }
            
            // Filter state
            let currentStatusFilter = 'all';
            
            function setStatusFilter(status, btn) {
                currentStatusFilter = status;
                // Update button styles
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.style.background = '#1f2937';
                    b.style.color = '#9ca3af';
                    b.style.border = '1px solid #374151';
                });
                btn.style.background = '#3b82f6';
                btn.style.color = 'white';
                btn.style.border = 'none';
                filterAccounts();
            }
            
            function filterAccounts() {
                const searchTerm = document.getElementById('accountSearch').value.toLowerCase();
                const cards = document.querySelectorAll('.account-card');
                let visibleCount = 0;
                
                cards.forEach(card => {
                    const creditor = card.querySelector('.creditor-name').textContent.toLowerCase();
                    const statusBadge = card.querySelector('.status-badge');
                    const status = statusBadge ? statusBadge.textContent.toLowerCase() : '';
                    
                    // Search match
                    const matchesSearch = creditor.includes(searchTerm);
                    
                    // Status match
                    let matchesStatus = true;
                    if (currentStatusFilter === 'open') {
                        matchesStatus = status.includes('open') || status.includes('current') || 
                                       status.includes('pays') || status.includes('paying') ||
                                       status.includes('past due') || status.includes('late');
                    } else if (currentStatusFilter === 'closed') {
                        matchesStatus = status.includes('closed') || status.includes('terminated') || 
                                       status === 'paid' || status.includes('paid satisf');
                    } else if (currentStatusFilter === 'negative') {
                        matchesStatus = status.includes('late') || status.includes('past due') || 
                                       status.includes('collection') || status.includes('charge') ||
                                       status.includes('delinq') || status.includes('30') ||
                                       status.includes('60') || status.includes('90');
                    } else if (currentStatusFilter === 'au') {
                        const auBadge = card.querySelector('.creditor-name span');
                        matchesStatus = auBadge && auBadge.textContent === 'AU';
                    } else if (currentStatusFilter === 'discrepancy') {
                        const discBadge = card.querySelector('.creditor-name');
                        matchesStatus = discBadge && discBadge.textContent.includes('DISCREPANCY');
                    }
                    
                    if (matchesSearch && matchesStatus) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });
                
                // Update count
                const total = cards.length;
                document.getElementById('filterCount').textContent = 
                    visibleCount === total ? '' : `Showing ${visibleCount} of ${total}`;
            }
            
            // Auto-expand ALL accounts
            document.addEventListener('DOMContentLoaded', function() {
                const allAccounts = document.querySelectorAll('.account-details');
                allAccounts.forEach(account => {
                    account.classList.add('show');
                });
            });
    </script>
</body>
</html>
