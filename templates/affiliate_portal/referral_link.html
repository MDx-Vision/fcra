{% extends "affiliate_portal/base.html" %}
{% set active_page = 'referral_link' %}

{% block title %}Referral Link{% endblock %}

{% block extra_styles %}
<style>
    .referral-box {
        background: rgba(15, 23, 42, 0.8);
        border: 2px solid rgba(34, 197, 94, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 20px;
    }
    .referral-url {
        display: flex;
        gap: 12px;
        margin-top: 12px;
    }
    .referral-url input {
        flex: 1;
        padding: 14px 16px;
        background: rgba(30, 41, 59, 0.8);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 8px;
        color: #22c55e;
        font-size: 15px;
        font-family: monospace;
    }
    .referral-url input:focus {
        outline: none;
        border-color: #22c55e;
    }
    .copy-btn {
        padding: 14px 24px;
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        border: none;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
    }
    .copy-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
    }
    .copy-btn.copied {
        background: #10b981;
    }

    .affiliate-code-box {
        text-align: center;
        padding: 30px;
        background: rgba(15, 23, 42, 0.5);
        border-radius: 12px;
    }
    .affiliate-code {
        font-size: 36px;
        font-weight: 700;
        font-family: monospace;
        color: #22c55e;
        letter-spacing: 4px;
        margin: 16px 0;
    }

    .share-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 20px;
    }
    .share-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 12px 20px;
        border-radius: 8px;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.2s;
    }
    .share-btn.facebook { background: #1877f2; color: white; }
    .share-btn.twitter { background: #1da1f2; color: white; }
    .share-btn.linkedin { background: #0077b5; color: white; }
    .share-btn.email { background: #64748b; color: white; }
    .share-btn:hover { transform: translateY(-2px); }

    .marketing-tips {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        margin-top: 20px;
    }
    .tip-card {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 20px;
    }
    .tip-card h4 {
        color: #22c55e;
        margin-bottom: 8px;
    }
    .tip-card p {
        color: #94a3b8;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title" data-testid="page-title">Your Referral Link</h1>
    <p class="page-subtitle">Share this link to earn commissions on every signup</p>
</div>

<!-- Referral Link Box -->
<div class="card">
    <h3 class="card-title" style="margin-bottom: 16px;">Your Unique Referral Link</h3>
    <div class="referral-box">
        <p style="color: #94a3b8; font-size: 14px;">Share this link with potential clients. When they sign up, you'll earn a commission!</p>
        <div class="referral-url">
            <input type="text" id="referral-link" value="{{ referral_url }}" readonly data-testid="referral-url">
            <button class="copy-btn" onclick="copyLink()" data-testid="copy-btn">Copy Link</button>
        </div>
    </div>

    <!-- Affiliate Code -->
    <div class="affiliate-code-box">
        <p style="color: #64748b;">Your Affiliate Code</p>
        <div class="affiliate-code" data-testid="affiliate-code">{{ affiliate.affiliate_code }}</div>
        <p style="color: #64748b; font-size: 14px;">Clients can enter this code during signup</p>
    </div>

    <!-- Share Buttons -->
    <div class="share-buttons" data-testid="share-buttons">
        <a href="https://www.facebook.com/sharer/sharer.php?u={{ referral_url|urlencode }}" target="_blank" class="share-btn facebook">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/></svg>
            Facebook
        </a>
        <a href="https://twitter.com/intent/tweet?url={{ referral_url|urlencode }}&text=Check%20out%20Brightpath%20Ascend%20for%20credit%20repair!" target="_blank" class="share-btn twitter">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/></svg>
            Twitter
        </a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ referral_url|urlencode }}" target="_blank" class="share-btn linkedin">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg>
            LinkedIn
        </a>
        <a href="mailto:?subject=Credit%20Repair%20Services&body=Check%20out%20Brightpath%20Ascend%20for%20credit%20repair:%20{{ referral_url|urlencode }}" class="share-btn email">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
            Email
        </a>
    </div>
</div>

<!-- Marketing Tips -->
<div class="card" style="margin-top: 20px;">
    <h3 class="card-title" style="margin-bottom: 16px;">Marketing Tips</h3>
    <div class="marketing-tips">
        <div class="tip-card">
            <h4>Social Media</h4>
            <p>Share your link on Facebook, Instagram, and LinkedIn. Personal stories about credit repair work best!</p>
        </div>
        <div class="tip-card">
            <h4>Word of Mouth</h4>
            <p>Tell friends and family about credit repair services. Referrals from trusted sources convert best.</p>
        </div>
        <div class="tip-card">
            <h4>Local Community</h4>
            <p>Connect with real estate agents, car dealers, and mortgage brokers who often need credit repair referrals.</p>
        </div>
        <div class="tip-card">
            <h4>Content Marketing</h4>
            <p>Create blog posts or videos about credit tips and include your referral link in the description.</p>
        </div>
    </div>
</div>

<!-- Commission Rates -->
<div class="card" style="margin-top: 20px;">
    <h3 class="card-title" style="margin-bottom: 16px;">Your Commission Rates</h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
        <div style="text-align: center; padding: 20px; background: rgba(34, 197, 94, 0.1); border-radius: 12px;">
            <div style="font-size: 36px; font-weight: 700; color: #22c55e;">{{ "%.0f"|format((affiliate.commission_rate_1 or 0.10) * 100) }}%</div>
            <div style="color: #94a3b8; font-size: 14px; margin-top: 8px;">Level 1 (Direct Referrals)</div>
        </div>
        <div style="text-align: center; padding: 20px; background: rgba(59, 130, 246, 0.1); border-radius: 12px;">
            <div style="font-size: 36px; font-weight: 700; color: #3b82f6;">{{ "%.0f"|format((affiliate.commission_rate_2 or 0.05) * 100) }}%</div>
            <div style="color: #94a3b8; font-size: 14px; margin-top: 8px;">Level 2 (Sub-Affiliate Referrals)</div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function copyLink() {
    const input = document.getElementById('referral-link');
    input.select();
    input.setSelectionRange(0, 99999);
    navigator.clipboard.writeText(input.value);

    const btn = document.querySelector('.copy-btn');
    btn.textContent = 'Copied!';
    btn.classList.add('copied');

    setTimeout(() => {
        btn.textContent = 'Copy Link';
        btn.classList.remove('copied');
    }, 2000);
}
</script>
{% endblock %}
